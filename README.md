# Работа с журналами
1. Настройте выполнение контрольной точки раз в 30 секунд. ``` alter system set checkpoint_timeout = '30s'; ``` перезагрузка сервера```select pg_reload_conf();```
2. 10 минут c помощью утилиты pgbench подавайте нагрузку. ```\! pgbench -i -s 100;``` ответ:```done in 616.19 s (drop tables 0.00 s, create tables 0.01 s, client-side generate 76.88 s, vacuum 279.13 s, primary keys 260.16 s).```
3. Измерьте, какой объем журнальных файлов был сгенерирован за это время. Оцените, какой объем приходится в среднем на одну контрольную точку. ```buffers_checkpoint - 4495``, ``` checkpoints_timed - 86``` на одну точку ~ 52
4. Проверьте данные статистики: все ли контрольные точки выполнялись точно по расписанию. Почему так произошло? ```checkpoints_req - 2``` погуглил, нашел как мне кажется 1 подходящий в этой ситуации вариант: постгрес мог запросить контрольную точку при достиджении определенного порогового значения WAL, чтобы очистить устаревшие журнальные файлы.
5. Сравните tps в синхронном/асинхронном режиме утилитой pgbench. Объясните полученный результат.
   синхронный: ```set synchronous_commit = on;``` ```\! pgbench -i -s 100;``` ```done in 263.09 s (drop tables 0.91 s, create tables 0.03 s, client-side generate 63.98 s, vacuum 179.19 s, primary keys 18.97 s).```
   асинхронный ```set synchronous_commit = off;``` ```\! pgbench -i -s 100;``` ```done in 192.77 s (drop tables 0.15 s, create tables 0.01 s, client-side generate 45.08 s, vacuum 124.54 s, primary keys 22.99 s).```
   Вероятнее всего асинхронный оказался быстрее по следующим причинам: отсутствие ожидания подтверждения от реплик, меньшая нагрузка на реплики,  меньшая степень гарантий согласованности, но асинхроный режим хоть и быстрее, но менее надежен 
7. Создайте новый кластер с включенной контрольной суммой страниц. Создайте таблицу. Вставьте несколько значений. Выключите кластер. Измените пару байт в таблице. Включите кластер и сделайте выборку из таблицы. Что и почему произошло? как проигнорировать ошибку и продолжить работу?
создал новый кластер ```su - postgres -c '/usr/lib/postgresql/14/bin/pg_checksums --enable -D "/var/lib/postgresql/14/main"'``` ответ:
```
Checksum operation completed
Files scanned:  931
Blocks scanned: 3219
pg_checksums: syncing data directory
pg_checksums: updating control file
Checksums enabled in cluster
```
